(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&t(n)}).observe(document,{childList:!0,subtree:!0});function s(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(i){if(i.ep)return;i.ep=!0;const r=s(i);fetch(i.href,r)}})();class m{constructor(){this.s=0,this.m=0,this.h=0,this.timerElement=document.querySelector(".timer"),this.intervalId=null}getTime(){return this.timerElement.textContent}addTime=()=>{this.s+=1,this.s===60&&(this.s=0,this.m+=1,this.m===60&&(this.m=0,this.h+=1)),this.timerElement.textContent=`${this.formatNum(this.h)}:${this.formatNum(this.m)}:${this.formatNum(this.s)}`};startTimer(){this.intervalId||(this.intervalId=setInterval(this.addTime,1e3))}pauseTimer(){clearInterval(this.intervalId),this.intervalId=null}resetTimer(){clearInterval(this.intervalId),this.intervalId=null,this.h=0,this.m=0,this.s=0,this.timerElement.textContent=`${this.formatNum(this.h)}:${this.formatNum(this.m)}:${this.formatNum(this.s)}`}formatNum(e){return e.toString().padStart(2,"0")}}const f="/minesweeper/assets/defaultClick-LezoCLKe.wav",g="/minesweeper/assets/flagSound-CCSz7ZCu.wav",p="/minesweeper/assets/mineSound-4RpPOBhq.mp3",v="/minesweeper/assets/victorySound-Cotk5nk8.mp3";class C{constructor(){this.defaultAudio=new Audio(f),this.flagAudio=new Audio(g),this.mineAudio=new Audio(p),this.victoryAudio=new Audio(v)}playDefault(){this.defaultAudio.load(),this.defaultAudio.play()}playFlag(){this.flagAudio.load(),this.flagAudio.play()}playMine(){this.mineAudio.load(),this.mineAudio.play()}playVictory(){this.victoryAudio.load(),this.victoryAudio.play()}}function c(o){return Math.floor(Math.random()*o)}class b{#s=!1;#t=!1;#e=!1;#i=0;constructor(){this.element=null}setMine(){this.#s=!0}setNeighborMines(e){this.#i=e}reveal(){this.#e||this.#t||(this.#t=!0)}toggleFlag(){if(!this.#t)return this.#e=!this.#e,this.#e}get isMine(){return this.#s}get isRevealed(){return this.#t}get isFlagged(){return this.#e}get neighborMines(){return this.#i}}class y{constructor(e,s){this.size=e,this.mode=s,this.mines=0,this.flags=0,this.cells=[],this.openCells=0,this.isGameOver=!1,this.onGameOver=null,this.isWinner=!1,this.onCellReveal=null,this.deltas=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]],this.createBoard()}createBoard(){this.createEmptyCells(),this.createMines(),this.placeMines(),this.neighborMines()}createEmptyCells(){this.cells=[];for(let e=0;e<this.size;e++){let s=[];for(let t=0;t<this.size;t++){const i=new b;s.push(i)}this.cells.push(s)}}createMines(){let e=this.size*this.size;switch(this.mode){case"easy":this.mines=Math.round(e*.1);break;case"normal":this.mines=Math.round(e*.15);break;case"hard":this.mines=Math.round(e*.2);break}}placeMines(){for(let e=0;e<this.mines;e++){let s=c(this.size),t=c(this.size);if(this.cells[s][t].isMine){e--;continue}this.cells[s][t].setMine()}}neighborMines(){this.cells.forEach((e,s)=>{e.forEach((t,i)=>{let r=0;this.deltas.forEach(([n,l])=>{const a=s+n,h=i+l;a>=0&&a<this.size&&h>=0&&h<this.size&&this.cells[a][h].isMine&&r++}),t.setNeighborMines(r)})})}revealCell(e,s){const t=this.cells[e][s];if(!t.isRevealed){if(t.reveal(),this.openCells++,this.onCellReveal&&this.onCellReveal(e,s),t.isMine){this.isGameOver=!0,this.onGameOver&&this.onGameOver();return}t.isFlagged&&this.flagSetter(e,s),t.neighborMines===0&&this.revealEmptyCells(e,s),this.checkWinner()}}revealEmptyCells(e,s){setTimeout(()=>{this.deltas.forEach(([t,i])=>{const r=e+t,n=s+i;if(r>=0&&r<this.size&&n>=0&&n<this.size){const l=this.cells[r][n];!l.isRevealed&&!l.isMine&&(l.isFlagged&&this.flagSetter(r,n),l.reveal(),this.openCells++,this.onCellReveal&&this.onCellReveal(r,n),l.neighborMines===0&&this.revealEmptyCells(r,n))}})},10)}flagSetter(e,s){const t=this.cells[e][s];t.toggleFlag(),t.isFlagged?this.flags+=1:this.flags-=1}checkWinner(){this.openCells===this.size*this.size-this.mines&&(this.isWinner=!0)}}class M{constructor(e,s,t){this.timer=e,this.sound=s,this.board=null,this.records=t,this.boardContainer=document.querySelector("#board"),this.sizeButtons=document.querySelectorAll(".size"),this.modeButtons=document.querySelectorAll(".mode"),this.flagsCounter=document.querySelector("#nFlagsPlaced"),this.minesCounter=document.querySelector("#nAllMines"),this.setupMenu(),this.records.loadRecords()}setupMenu(){const e=[8,16,24],s=["easy","normal","hard"];this.sizeButtons.forEach((t,i)=>{t.addEventListener("click",()=>{this.selectSize(e[i]),this.handleActiveBtn(this.sizeButtons,t)})}),this.modeButtons.forEach((t,i)=>{t.addEventListener("click",()=>{this.selectMode(s[i]),this.handleActiveBtn(this.modeButtons,t)})})}handleActiveBtn(e,s){e.forEach(t=>t.classList.remove("active")),s.classList.add("active")}selectSize(e){this.selectedSize=e,this.tryStartGame()}selectMode(e){this.selectedMode=e,this.tryStartGame()}tryStartGame(){this.selectedSize&&this.selectedMode&&this.startGame(this.selectedSize,this.selectedMode)}startGame(e,s){this.board=new y(e,s),this.board.onCellReveal=(t,i)=>{this.renderCell(t,i)},this.board.onGameOver=()=>this.handleGameOver(),this.renderBoard(this.boardContainer),this.timer.resetTimer(),this.timer.startTimer()}renderBoard(e){e.innerHTML="";const s=document.createElement("table");s.id="table";const t=document.querySelector("#board-wrapper");for(let i=0;i<this.board.size;i++){const r=document.createElement("tr");for(let n=0;n<this.board.size;n++){const l=document.createElement("td");this.board.cells[i][n].element=l,l.addEventListener("click",d=>{d.button===0&&this.handleCellClick(i,n)}),l.addEventListener("contextmenu",d=>this.handleFlagClick(d,i,n));let a=null,h=!1;l.addEventListener("touchstart",d=>{h=!1,a=setTimeout(()=>{h=!0,this.handleFlagClick(d,i,n)},500)}),l.addEventListener("touchend",d=>{clearTimeout(a),h||this.handleCellClick(i,n)}),l.addEventListener("pointercancel",()=>clearTimeout(a)),r.appendChild(l)}s.appendChild(r)}e.appendChild(s),t.className="board-wrapper"}renderCell(e,s){const t=this.board.cells[e][s],i=t.element;if(i){if(t.isMine){i.classList.add("mine"),i.textContent="ðŸ’£";return}t.isRevealed&&t.neighborMines===0&&(t.element.style.backgroundColor="white",i.classList.add("revealed")),t.neighborMines>0?(i.textContent=t.neighborMines,i.classList.add(`num-${t.neighborMines}`)):i.textContent=""}}handleCellClick(e,s){const t=this.board.cells[e][s];if(!(this.board.isGameOver||this.board.isWinner||t.isRevealed)&&(this.board.revealCell(e,s),this.updateCounters(),t.isMine||this.sound.playDefault(),this.board.openCells===this.board.size*this.board.size-this.board.mines)){if(this.board.isGameOver)return;this.handleVictory()}}handleFlagClick(e,s,t){e.preventDefault();const i=this.board.cells[s][t];this.board.isGameOver||this.board.isWinner||i.isRevealed||(this.sound.playFlag(),!i.isRevealed&&(i.element.classList.toggle(".flagged"),i.element.textContent==="ðŸš©"?(i.element.textContent="",this.board.flagSetter(s,t)):(i.element.textContent="ðŸš©",this.board.flagSetter(s,t)),this.updateCounters()))}updateCounters(){this.flagsCounter.textContent=this.board.flags,this.minesCounter.textContent=this.board.mines}handleGameOver(){this.timer.pauseTimer(),this.showMessage("Â¡Fin del Juego!"),this.sound.playMine(),this.board.cells.flat().forEach(e=>{e.isMine&&(e.element.textContent="ðŸ’£")})}handleVictory(){this.timer.pauseTimer(),this.showMessage("Â¡Has ganado!"),this.sound.playVictory(),this.records.setRecord(this.selectedMode,this.selectedSize,this.timer.getTime())}showMessage(e){const s=document.createElement("div");s.className="game-over-message",s.textContent=e,document.body.appendChild(s),setTimeout(()=>{document.body.removeChild(s)},5e3)}}function u(o){const[e,s,t]=o.split(":").map(Number);return e*3600+s*60+t}class S{constructor(e){this.timer=e,this.timesDOMElement=document.querySelectorAll(".timeSpan")}setRecord(e,s,t){const i=u(t);this.timesDOMElement.forEach(r=>{if(r.dataset.mode===e&&Number(r.dataset.size)===s){let n=r.textContent;n==="SIN TIEMPO"?n=1/0:n=u(r.textContent),i<n&&(localStorage.setItem(`${e}-${s}`,t),this.loadRecords())}})}loadRecords(){this.timesDOMElement.forEach(e=>{for(let s=0;s<localStorage.length;s++){const[t,i]=localStorage.key(s).split("-");e.dataset.mode===t&&e.dataset.size===i&&(e.textContent=localStorage.getItem(`${t}-${i}`))}})}}function E(){const o=new m,e=new C,s=new S;new M(o,e,s)}E();
